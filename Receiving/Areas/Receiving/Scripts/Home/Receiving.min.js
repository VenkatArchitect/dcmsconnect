function LoadPrinters(n){var t=$("select",n.delegateTarget);$.get(n.data.url).then(function(n,t,i){$.each(n,function(n,t){var i=$("<option><\/option>").val(t.Name).text(t.Name+" : "+t.Description);t.Name===this.selected&&i.attr("selected","selected");this.ddl.append(i)}.bind({ddl:this.ddl,selected:i.getResponseHeader("Selected")}))}.bind({ddl:t}),function(n,t){var i=$("<option><\/option>").val("").html('<span class="bg-danger">Could not retrieve printer list: '+t+" "+n.status+"<\/span>");this.append(i)}.bind(this))}function OnPrint(n){function t(n,t){$("div.alert",this).removeClass().addClass("alert").addClass(t).html(n)}var i=$(n.delegateTarget),r=$("select",i).val();if(!r){t.call(i,"Please Select a printer","alert-warning");return}n.data.postdata[0].value=$("span.cartonId",i).text();n.data.postdata[1].value=r;$.post(n.data.url,n.data.postdata).then(function(n,i,r){t.call(this.dlg,r.responseText,r.status===203?"alert-warning":"alert-success")}.bind({dlg:n.delegateTarget}),function(n){Sound.error();t.call(this.dlg,n.responseText,"alert-danger")}.bind({dlg:n.delegateTarget}))}function OnRemove(n){var t=$(n.delegateTarget);n.data.postdata[0].value=$("span.cartonId",t).text();$.post(n.data.url,n.data.postdata).then(function(n){t.modal("hide");Tabs.html(n);Progress.update(-1)}.bind({dlg:n.delegateTarget}),function(n){Sound.error();alert("Error: "+n.responseText)}.bind({dlg:n.delegateTarget}))}var Sound=function(){"use strict";var n={error:null,success:null},t=function(t){n=$.extend(n,t)},i=function(){$(n.error).one("ended",function(){this.play()})[0].play()},r=function(){$(n.success)[0].play()};return{init:t,error:i,success:r}}(),Progress=function(){"use strict";var n={bar:"#progressCartons",receivedCount:"#receivedCount"},t=function(t){n=$.extend(n,t)},i=function(t){var i=$(n.bar+"div.progress-bar"),r=parseInt(i.attr("aria-valuenow"))+t,e=parseInt(i.attr("aria-valuemax")),u=Math.round(r*100/e),f;i.attr("aria-valuenow",r).css("width",u+"%").find("span").text(u);f=parseInt($(n.receivedCount).text());$(n.receivedCount).text(f+t)};return{init:t,update:i}}(),Tabs=function(){"use strict";var n={tabContainer:"",contentContainer:"",loadUrl:"",pallets:[]},t="data-palletid",r=function(t){n=$.extend(n,t);var i;$.each(n.pallets,function(n,t){var r=Tabs.create(t);n===0&&(i=r)});$(n.tabContainer).on("click",".glyphicon-remove-sign",function(n){var t=$(this).closest("li"),i,r;t.is(".active")&&(i=t.next(),i.length===0&&(i=$("li:first",n.delegateTarget)),$("a",i).tab("show"));r=$("a",t).attr("href");$(r).remove();t.remove()}).on("shown.bs.tab",function(){s()}).find("li:first a").tab("show")},i=function(){return $("> div.active.tab-pane",n.contentContainer)},u=function(){return $("> li.active",n.tabContainer).attr(t)},f=function(i){return $("<div><\/div>").attr("id","Pallet_"+i).addClass("tab-pane").appendTo(n.contentContainer),$("<li><\/li>").attr(t,i).append($("<a><\/a>").attr({href:"#Pallet_"+i,role:"tab","data-toggle":"tab",title:"Pallet "+i}).text(i).append(' <span title="Remove Pallet" class="glyphicon glyphicon-remove-sign text-info"><\/span>')).appendTo(n.tabContainer)},e=function(i){var r=$("> li["+t+'="'+i+'"] > a',n.tabContainer).tab("show");r.length>0||Tabs.create(i).find("a").tab("show")},o=function(n){i().html(n)},s=function(){return Tabs.html("Loading..."),$.get(n.loadUrl.replace("~",Tabs.activePalletId())).then(function(n){Tabs.html(n)},function(n){Tabs.html(n.responseText)})};return{init:r,create:f,activePalletId:u,html:o,show:e,activeContent:i}}(),HandleScan=function(){"use strict";var t,i,n={textarea:"",button:"",cartonUrl:$("#tbScan").data("carton-url"),cartonPostdata:function(n,t){return[{name:"processId",value:123},{name:"cartons",value:t},{name:"palletId",value:n},{name:"dispos",value:"something"}]},delay:3e3},r=function(){t&&(clearInterval(t),t=null);$("span.badge",n.button).addClass("hidden")},e=function(){r();i=n.delay;$("span.badge",n.button).removeClass("hidden").text("");t=setInterval(function(){i-=1e3;$("span.badge",n.button).text(i/1e3);i<=0&&u()},1e3)},o=function(){r();$(n.button).prop("disabled",!0).find("img").removeClass("hidden")},s=function(){$(n.button).prop("disabled",!1).find("img").addClass("hidden")},h=function(t){n=$.extend(n,t);$(n.textarea).on("keypress",function(n){(r(),n.which===13)&&(Sound.success(),e())}).popover({trigger:"manual",html:!0,title:'<strong class="text-danger"><span class="text-danger glyphicon glyphicon-warning-sign"><\/span> Error Message<\/strong><a class="close text-danger" href="#">&times;<\/a>',placement:"auto",container:"body"});$(document).on("click",".close",function(){$(n.textarea).popover("hide").focus()});$(document).on("click",n.button,function(){u()})},u=function(){var i;if(r(),i=$.grep($(n.textarea).val().toUpperCase().split("\n"),function(n){return n.trim().toUpperCase()!==""}),i.length!==0){var u=$.Deferred(o),t=u,e=i[i.length-1];e.toUpperCase().indexOf("P")===0?(i.length>1&&(t=t.then(f.bind(undefined,i.slice(0,i.length-1)))),t=t.then(c.bind(undefined,e))):t=t.then(f.bind(undefined,i));t=t.always(s);t.done(function(){$(this.tb).val("").focus()}.bind({tb:n.textarea}));u.resolve()}},f=function(t){return $.post(n.cartonUrl,n.cartonPostdata(Tabs.activePalletId(),t)).then(function(n){Tabs.html(n);Progress.update(this.count)}.bind({count:t.length}),l)},c=function(n){Tabs.show(n)},l=function(t,i,r){Sound.error();var u=$(n.textarea);switch(t.status){case 500:u.attr("data-content",t.responseText);break;default:u.attr({"data-content":"Error "+t.status+": "+r})}u.popover("show")};return{init:h}}();$(document).ready(function(){$("#btnNewPallet").click(function(){alert("auto increment tab with pallet id")})});