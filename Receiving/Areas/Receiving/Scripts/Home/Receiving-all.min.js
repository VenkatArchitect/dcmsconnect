function PlaySound(n){var t=$("#sound_"+n),i=$("embed",t).removeAttr("autostart").attr("autostart",!0);t.children("div:first").html(i[0].outerHTML);setTimeout(function(){$("#scan").val("").focus()},0)}function updateReceivingProgressBar(n,t){var i=parseInt(n*100/t),r=$("#receivingProgress");r.attr("title",i+"% completed, "+n+" cartons out of "+t+" expected cartons received");$("div",r).eq(0).css("width",(i>100?100:i)+"%").end().eq(1).find("span:first").text(i+"% ["+n+" of "+t+" cartons]")}function getActiveTab(){return $("> ul.ui-tabs-nav > li.ui-state-active",$("#tabs"))}function populateActiveTab(n,t){var i=t.attr("aria-controls");$("#"+i,$("#tabs")).html(n)}(function(n){function s(n){var t=0,r;if(!n)return t;for(i=0;i<n.length;i++)r=n.charCodeAt(i),t=(t<<5)-t+r,t=t&t;return Math.abs(t)%10+1}function h(){if(e!=null){n("#scan").attr("disabled","disabled");PlaySound("success");populateActiveTab(e.data,getActiveTab());var i=n("ul.ui-tabs-nav li.ui-state-active",t).attr("data-disposition",e.cartonDisposition),r=s(e.cartonDisposition);r!=-1&&n("a",i).text(r.toString()+". "+i.attr("data-palletid"));e=null;n("#scan").removeAttr("disabled")}u&&clearTimeout(u);u=null}var r,t,o,f,u,e=null;n.sequentialAjax=function(i){function c(i){var r,u;li="<li data-palletid='"+i+"' data-disposition='"+i+"'><a href='#Pallet_"+i+"' title='Pallet "+i+"'>"+i+"<\/a><span title='Remove Pallet' class='ui-icon ui-icon-close'><\/span><\/li>";t.find("ul.ui-tabs-nav").append(li);n("<div id='Pallet_"+i+"'><\/div>").appendTo(t);t.tabs("refresh");index=n("li",t).length-1;t.tabs("option","active",index);r=getActiveTab();r.effect("pulsate");u=r.attr("data-palletid");n("#tbPalletId").val(u);t.show()}u&&clearTimeout(u);u=setTimeout(h,2e3);r||(r=n("#spanErrorMessage"),t=n("#tabs"),o=n("#statusList"));r.hide();f&&clearTimeout(f);f=setTimeout(function(){n("#dlgScanCartonsStatus").dialog("open")},2e3);o.prepend("<li><span><\/span><span>"+i+"<\/span><\/li>").queue(function(l){n("li:not(:has(span.ui-state-error)) span",o).eq(0).addClass("processing-state").end().eq(1).addClass("ui-state-active");n.ajax({url:n("#scan").attr("data-ajax-url"),type:"POST",data:n("#frmScan").serialize()+"&ScanModel.ScanText="+i,statusCode:{201:function(t,i,r){e={data:t,cartonDisposition:r.getResponseHeader("Disposition")||""};updateReceivingProgressBar(r.getResponseHeader("ReceivedCartonCount"),r.getResponseHeader("ExpectedCartonCount"));n("#hfReceivedCartonsCount").val(r.getResponseHeader("ReceivedCartonCount"));u||h()},202:function(i,u,f){var o=f.getResponseHeader("PalletId")||"",e=n('> ul.ui-tabs-nav > li[data-palletid="'+o+'"]',t),s=e.index(),a=t.tabs("option","active"),l,h;if(s==-1){if(l=f.getResponseHeader("Disposition")||"",e=n("> ul.ui-tabs-nav > li[data-disposition="+l+"]",t),h=e.attr("data-palletid"),h){r.show().html("Pallet "+h+" has the same disposition. Ignoring pallet scan.");PlaySound("warning");e.effect("pulsate");return}c(o)}else s==a?(r.show().html("Pallet "+o+" is already active. Please scan a carton."),PlaySound("warning")):t.tabs("option","active",s);PlaySound("palletscan");populateActiveTab(i,getActiveTab())},203:function(){PlaySound("error")},250:function(i){var f=n("> ul.ui-tabs-nav > li[data-disposition="+i+"]",t),e=f.attr("data-palletid"),u;e||(f=n('> ul.ui-tabs-nav > li[data-disposition=""]',t),e=f.attr("data-palletid"));u=s(i);u==-1&&(u=s(i));e?(r.show().html("Scan Pallet "+e),f.each(function(){n(this).find("a").text(u.toString()+". "+n(this).attr("data-palletid"))}).effect("pulsate")):r.show().html("Scan New Pallet");PlaySound(u.toString())},251:function(i){var u=n("> ul.ui-tabs-nav > li[data-palletid="+i+"]",t);u&&(r.show().html("Scan Pallet "+i),u.effect("pulsate"));PlaySound("warning")}},error:function(n){alert(n.responseText);PlaySound("error");o.queue([])}}).success(function(t,i,r){var u,s;if(r.status==203?u=t:r.status==250?u=r.getResponseHeader("ErrorMsg"):r.status==251&&(u=r.getResponseHeader("ErrorMsg")),s=n("li:has(span.ui-state-active)",o),f&&(clearTimeout(f),f=null),u){var h=new Date,c=h.getHours(),a=h.getMinutes(),v=h.getSeconds(),e=c+":"+a+":"+v;c>11?e+=" PM":e=e+" AM";n("span",s).eq(0).removeClass("processing-state").text(e+" - ").addClass("ui-state-hover").end().eq(1).text(u).removeClass("ui-state-active").addClass("ui-state-error");n("#dlgScanCartonsStatus").dialog("open")}else s.remove();l()})})}})(jQuery);$(document).ready(function(){$("#tabs").tabs({tabTemplate:"<li data-palletid='#{href}' data-disposition='#{label}'><a href='#Pallet_{href}' title='Pallet #{href}'>#{href}<\/a><span title='Remove Tab' class='ui-icon ui-icon-close'><\/span><\/li>"}).click(function(n){var t,u,f,r,i;$(n.target).is("ul.ui-tabs-nav .ui-icon-close")?(u=$("li",this).index($(n.target).parent()),f=$(this).find($("li:eq('"+u+"')",this)).remove().attr("aria-controls"),$("#"+f).remove(),$("#tabs").tabs("refresh"),$("li",$("#tabs")).length==0&&($("#tabs").hide(),$("#tbPalletId").val(""))):$(n.target).is("div.ui-tabs-panel .ui-icon-close")?(t=$(n.target).parents("tr").find(".recv-carton").html(),r=getActiveTab(),i=r.attr("data-palletid"),confirm("Do you want to remove carton "+t+" from pallet "+i+"?")?$.ajax({url:$(this).attr("data-remove-carton"),type:"POST",data:JSON.stringify({cartonId:t,processId:$("span.recv-processId").html(),palletId:i}),context:this,contentType:"application/json; charset=utf-8",statusCode:{203:function(n){$("#spanErrorMessage").show().html(n);PlaySound("error")},200:function(n,t,i){var u=i.getResponseHeader("Disposition")||"",r;populateActiveTab(n,getActiveTab());$("> ul.ui-tabs-nav > li.ui-state-active",this).attr("data-disposition",u);r=parseInt($("#hfReceivedCartonsCount").val())-1;$("#hfReceivedCartonsCount").val(r);updateReceivingProgressBar(r,$("#hfExpectedCartonsCount").val())}},error:function(n){$("> div.ui-tabs-panel:not(.ui-tabs-hide)",this).html(n.responseText);PlaySound("error")},complete:function(){setTimeout(function(){$("#scan").val("").focus()},0)}}):$(n.target).parent().removeClass("ui-state-active")):$(n.target).is("div.ui-tabs-panel .ui-icon-print")?(t=$(n.target).parents("tr").find(".recv-carton").html(),$("#dialog-print").data("cartonId",t).dialog("open")):$(n.target).is("a")&&(r=getActiveTab(),i=r.attr("data-palletid"),$("#tbPalletId").val(""),$("#tbPalletId").val(i))})});$(document).ready(function(){$("#dialog-print").dialog({autoOpen:!1,height:250,width:400,modal:!0,title:"Print Carton",draggable:!0,buttons:{Print:function(){$("#Printers").val()!=""?$.ajax({url:$("#frmprint").attr("data-print-url"),type:"POST",context:this,data:{cartonId:$(this).data("cartonId"),printer:$("#ddlprinters").val()},statusCode:{200:function(n){$("#spanErrorMessage").show().html(n+"  ").removeClass("ui-state-error").addClass("ui-state-highlight");$(this).dialog("close")},203:function(n){$("#dlgError").show().html(n);PlaySound("error")}},error:function(n){alert(n.responseText);PlaySound("error")},complete:function(){setTimeout(function(){$("#scan").val("").focus()},0)}}):$("#dlgError").show().html("Select Printer first")},Close:function(){setTimeout(function(){$("#scan").val("").focus()},0);$(this).dialog("close")}},close:function(){setTimeout(function(){$("#scan").val("").focus()},0);$("#CartonToPrint").val("")},open:function(){var n=$("#ddlprinters");n.children("option").remove();$("#CartonToPrint").text($(this).data("cartonId"));$("#dlgError").hide().html("");$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:n.attr("data-getprinters-url"),dataType:"json",success:function(t,i,r){var u=r.getResponseHeader("Selected");$.each(t,function(t,i){var r=$("<option><\/option>").val(i.Name).html(i.Name+" : "+i.Description);i.Name===u&&r.attr("selected","selected");n.append(r)})},complete:function(){setTimeout(function(){$("#scan").val("").focus()},0)}})}})});$(document).ready(function(){function t(){return $.trim($(this).val())&&$.sequentialAjax($(this).val()),$(this).val(""),!1}var n=$("#scan").keypress(function(n){return n.stopPropagation(),n.which==$.ui.keyCode.ENTER?t.apply(this):void 0});setTimeout(function(){n.focus()},0);$("#btnNewPallet").click(function(){n.val($(this).attr("data-new-pallet"));t.apply(n[0])}).button();$("body").keypress(function(){n.focus().val("")});$("#dlgScanCartonsStatus").dialog({close:function(){$("ol",this).empty()},width:300,height:300,autoOpen:!1,position:["right","top"],dialogClass:"progress-dialog"});$("#divCartonsDialog").dialog({title:"Cartons Not On Pallet",autoOpen:!1,modal:!0,closeOnEscape:!0,buttons:[{text:"OK",click:function(){$("#dlgError").html("");$(this).dialog("close")}}],open:function(){var n=$("span.recv-processId").html();$.ajax({type:"GET",context:this,url:$("#divCartonsDialog").attr("data-list-url"),data:{processId:n},cache:!1,statusCode:{200:function(n){$("#divCartonsDialog").html(n)}},error:function(n){alert(n.responseText)}})}});$("#linkShowCarton").click(function(){$("#divCartonsDialog").dialog("open")})});