@*
Code to use the layout in the Mobile directory for calls from mobile devices.
Inspired by http://www.michaelfcollins3.me/2011/01/changing-your-razor-view-layout-for-themes-and-devices/
Determines the path of the layout page based on device specific rules.
*@
@{
    if (string.IsNullOrEmpty(this.Layout))
    {
        // If layout has already been set by the view, do not change it
        var layoutResult = ViewEngines.Engines.FindPartialView(ViewContext.Controller.ControllerContext, MVC_DcmsMobile.SharedViews.Views.ViewNames._layoutMain);
        var layoutView = (RazorView)layoutResult.View;
        Layout = layoutView == null ? null : layoutView.ViewPath;
    }
    this.ViewContext.HttpContext.Trace.Write("Rendering View", this.ChildPage.VirtualPath);
    this.ViewContext.HttpContext.Trace.Write("Using Layout", this.Layout);
}
