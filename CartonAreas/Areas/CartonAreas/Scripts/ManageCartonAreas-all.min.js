$(document).ready(function(){$("button.mca-unassign").button({text:!1,icons:{primary:"ui-icon-close"}});$("button.mca-assign").button({text:!1,icons:{primary:"ui-icon-pencil"}});$("#divEditDialog").dialog({autoOpen:!1,width:"auto",modal:!0,closeOnEscape:!0,open:function(){var n=$(this).dialog("option","currentRow"),u,t,i,r,f,e;$("#lblSku em").text($("span.mca-sku",n).text());$("#lblAssignedVwh em").text($("span.mca-vwh",n).text());u=n.attr("data-location-id");t=n.find("span.mca-sku").text().replace(/\s+/g,"");t==""&&(t="NONE");i=n.find("span.mca-ctnSku").text();i==""&&(i="NONE");r=n.find("span.mca-vwh").text().replace(/\s+/g,"");r==""&&(r="NONE");f=n.find("span.mca-cartoncount").html();$(this).dialog({title:"Update Location #"+u});$(this).find("#tbMaxAssignedCarton").removeClass("input-validation-error");$("#displayCartonCount").html("<b>Location contains "+f+" cartons of SKU "+i+". <\/b>").addClass("ui-state-highlight");t!=""&&(e=n.find("span.mca-sku span").attr("title"),$("#tbSku").val(e),$("span.spnDisplaySku").html(n.find("span.mca-sku").text().replace(/\s+/g,"")));$("#tbAssignedVwh").val(r).attr("selected",!0);$("#tbMaxAssignedCarton").val(n.find("span.mca-maxassignedcartons").text().replace(/\s+/g,""));$("#hfCurrentLocationId",this).val(u);$("#ajaxErrors",this).empty();$("div[data-valmsg-summary]",this).removeClass("validation-summary-errors").addClass("validation-summary-valid");$("#btnUpdate").button({icons:{primary:"ui-icon-disk"}})},buttons:[{id:"btnUpdate",text:"Update",click:function(){var n=$("form",this),t;if(!n.valid())return $("#frmEditLocation input[data-ac-list-url]").autocompleteEx("clear"),$("input:text",this).val(""),!1;$("#tbSku").val()||$("#frmEditLocation input[data-ac-list-url]").autocompleteEx("clear");t=n.serializeArray();$.ajax({url:n.attr("action"),type:"POST",data:t,context:this,statusCode:{200:function(n){$("#divupdatefilter").html(n);var i=$(this).dialog("option","currentRow"),r=parseInt($("span.mca-cartoncount",i).html()),u=parseInt($("#tbMaxAssignedCarton",this).val()),t=isNaN(u)?null:u,f=Math.min(r*100/t,100);i.removeClass("ui-state-highlight").addClass("ui-state-active").find("span.mca-sku").html("<span title="+$("#tbSku").val()+">"+$("span.spnDisplaySku",this).html()+"<\/span>").end().find("span.mca-vwh").html($("#tbAssignedVwh",this).val()).end().find("span.mca-maxassignedcartons").html(t).end().find("div.ui-progressbar-value").width(f+"%").toggleClass("ui-state-error",(t==null?0:t)<r).end().find("button.mca-unassign").button("enable");$(this).dialog("close");$("input:text",this).val("");$("#frmEditLocation input[data-ac-list-url]").autocompleteEx("clear")},500:function(n){$("div[data-valmsg-summary]",this).html(n.responseText).removeClass("validation-summary-valid").addClass("validation-summary-errors");$("span.spnDisplaySku,#ajaxErrors",this).empty();$("input:text",this).val("");$("#frmEditLocation input[data-ac-list-url]").autocompleteEx("clear")}},error:function(n){alert(n.responseText)}})}},{text:"Cancel",click:function(){$(this).dialog("close")}}]});$("#divLocationList").on("click","button.mca-unassign",function(){var n=$(this).closest("tr").addClass("ui-state-highlight"),t=n.attr("data-location-id");if(!confirm("Assigned SKU from location "+t+" will be removed. Are you sure?"))return n.removeClass("ui-state-highlight"),!1;$.ajax($(this).attr("data-unassign-url"),{type:"POST"}).complete($.proxy(function(n){$("#divupdatefilter").html(n.responseText);this.row.addClass("ui-state-active").find("span.mca-sku,span.mca-maxassignedcartons,span.mca-vwh").empty();this.button.button("disable")},{row:n,button:$(this)})).error(function(n){alert(n.responseText)}).always($.proxy(function(){n.removeClass("ui-state-highlight")},{row:n}))}).on("click","button.mca-assign",function(){$("#divEditDialog").dialog("option","currentRow",$(this).closest("tr")).dialog("open")})}),function(n){n.widget("ui.autocompleteEx",n.ui.autocomplete,{widgetEventPrefix:"autocomplete",_create:function(){var t=this,i;this.options.source=function(i,r){n.ajax({url:t.element.attr("data-ac-list-url"),dataType:"json",data:{term:i.term,extra:t.element.attr("data-ac-extra-param")},success:function(n){r(n)},error:function(n){alert(n.responseText)}})};this.options.autoFocus=!1;this.options.delay=2e3;this.options.minLength=2;n.ui.autocomplete.prototype._create.apply(this,arguments);this.element.dblclick(function(){var n=t.options.minLength;t.options.minLength=0;t.search();t.options.minLength=n});i=t.element.attr("data-ac-validate-url");i&&this.element.rules("add",{remote:{url:t.element.attr("data-ac-validate-url"),async:!1,dataType:"json",beforeSend:function(){t.element.addClass("ui-autocomplete-loading")},dataFilter:function(i){var r=n.parseJSON(i),u;return n.isPlainObject(r)?(t._selectValue(r),JSON.stringify(!0)):(u=n.validator.format("span[data-ac-msg-for='{0}']",t.element.attr("name")),n(u).empty(),i)},complete:function(){t.element.removeClass("ui-autocomplete-loading")},error:function(n){alert(n.responseText)}}})},_trigger:function(t,i,r){var e=n.ui.autocomplete.prototype._trigger.apply(this,arguments),f,u;switch(t){case"select":return this._selectValue(r.item),f=this.element.closest("form").validate(),u=f.previousValue(this.element[0]),u.old=r.item.shortName,u.valid=!0,!1}return e},_selectValue:function(t){this.element.val(t.shortName||t.value).removeClass("input-validation-error");this.element.prev("input:hidden").val(t.value);var r=this.element.attr("name"),i=n.validator.format("span[data-ac-msg-for='{0}']",r);n(i).html(t.label);i=n.validator.format("span[data-valmsg-for='{0}']",r);n(i).removeClass("field-validation-error").addClass("field-validation-valid")},clear:function(){this._selectValue({value:"",label:"",shortName:""});var t=this.element.closest("form").validate(),n=t.previousValue(this.element[0]);n.old=null;n.valid=!0}})}(jQuery);$.validator.setDefaults({onkeyup:!1,onfocusout:!1});$(document).ready(function(){$("input[data-ac-list-url]").autocompleteEx()});