$.widget("ui.timespinner",$.ui.spinner,{options:{step:15*60,},_parse:function(a){if(!a){return null}switch($.type(a)){case"string":var b=a.split(/[\s:]+/);if(b[2]=="PM"&&Number(b[0])<12){b[0]=(Number(b[0])+12)%24}else{if(b[2]=="AM"&&b[0]==12){b[0]=0}}a=new Date(1970,1,1,b[0],b[1]);case"date":return Number(a)/1000;case"number":return a;default:alert("Unexpected parse in timespinner")}},_format:function(a){a=new Date(a*1000);a=$.fullCalendar.formatDate(a,"h:mm TT");return a}});$(document).ready(function(){var b;$("#dlgAppointment").dialog({autoOpen:false,width:"auto",modal:true,cache:false,closeOnEscape:true,create:function(c,d){$("#tbAppointmentDate").datepicker({showOn:"button",buttonImage:$("#tbAppointmentDate").attr("data-image-url"),buttonImageOnly:true,dateFormat:"m/d/yy",onSelect:function(){$(this).change()}});$("#tbAppointmentTime").timespinner()},open:function(d,e){var c=$(this).dialog("option","currentEvent");$("input:text, select, textarea",this).each(function(f){$(this).val(c[$(this).attr("name")])});$("#tbAppointmentDate").val($.datepicker.formatDate("m/d/yy",c.start));if(c.id){$("#tbAppointmentTime").timespinner("value",c.start)}else{$("#tbAppointmentTime").timespinner("value",420)}$("#divAjaxError").html("").removeClass("field-validation-error").addClass("filed-validation-valid")},buttons:[{text:"Save",click:function(h,j){var d=true;var c=$("#ddlBuilding").val();$("#ddlBuilding").toggleClass("ui-state-error",!c);d=d&&c;c=$("#tbAppointmentDate").val();try{$.datepicker.parseDate("m/d/yy",c)}catch(g){c=false}$("#tbAppointmentDate").toggleClass("ui-state-error",!c);d=d&&c;var i=$("#tbAppointmentTime").timespinner("value");c=i&&$.isNumeric(i);$("#tbAppointmentTime").toggleClass("ui-state-error",!c);d=d&&c;if(!d){return}var f=$("input:text, select, textarea",this).map(function(e){return{name:$(this).attr("name"),value:$(this).is("#tbAppointmentTime")?$("#tbAppointmentTime").timespinner("value"):$(this).val()}}).get();f.push({name:"id",value:$(this).dialog("option","currentEvent").id});f.push({name:"RowSequence",value:$(this).dialog("option","currentEvent").RowSequence});$.ajax({url:$("#calendar").attr("data-createupdate-url"),type:"POST",data:f,context:this,success:function(e,m,l){if(l.status==203){$("#divAjaxError").html(e).addClass("field-validation-error");return false}$(this).dialog("close");$("#calendar").fullCalendar("refetchEvents");var k=$.fullCalendar.parseDate(e.start);$("#calendar").fullCalendar("gotoDate",k);b.done(function(){var n=$("#calendar").fullCalendar("clientEvents",e.id);if(n.length>0){n[0].className="ui-selected";$("#calendar").fullCalendar("rerenderEvents")}})},error:function(k,l,e){alert(k.responseText)}});return false}},{text:"Cancel",click:function(c,d){$(this).dialog("close");return false}}]});$("#calendar").each(function(d){var h=this;var c;var g=$(this).attr("data-userLogged-in");var f=$(this).attr("data-initial-date");var e=$(this).attr("data-initial-appId");if(f){f=$.fullCalendar.parseISO8601(f,false)}$(this).fullCalendar({dayClick:function(j,i,k,l){if($(k.target).is(".app-addevent")){$("#dlgAppointment").dialog("option",{title:"Create New Appointment",currentEvent:{start:j}}).dialog("open");return}else{if($(k.target).is(".fc-day-number")){$(h).fullCalendar("gotoDate",j).fullCalendar("changeView","basicDay")}}},loading:function(i,j){$("#calendarLoading").toggleClass("ui-autocomplete-loading",i).toggle(i)},weekends:true,editable:false,disableResizing:true,defaultEventMinutes:120,theme:true,header:{left:"prev,next today",center:"title",right:"month,basicWeek,basicDay"},timeFormat:"h:mm TT",ignoreTimezone:false,defaultView:f?"basicDay":"basicWeek",eventClick:function(i,j,k){$(h).trigger(j,i);j.stopImmediatePropagation()},lazyFetching:true,allDayDefault:false,events:function(l,k,i){var j=$("#divBuildings input:checkbox:checked,#divFilter input:radio:checked,#tbCarrierFilter,#divShipped input:checkbox:checked").map(function(){return{name:$(this).attr("name"),value:$(this).val()}}).get();j.push({name:$(h).attr("data-start-param"),value:Math.round(+l/1000)});j.push({name:$(h).attr("data-end-param"),value:Math.round(+k/1000)});j.push({name:$(h).attr("data-viewname-param"),value:$(h).fullCalendar("getView").name});b=$.ajax({url:$(h).attr("data-event-url"),dataType:"json",data:j,traditional:true,cache:false,success:function(m,o,n){i(m);if(e){b.done(function(){var p=$("#calendar").fullCalendar("clientEvents",e);if(p.length>0){p[0].className="ui-selected";$("#calendar").fullCalendar("rerenderEvents")}})}},error:function(n,o,m){alert(n.responseText);i([])},})},eventRender:function(l,k,m){$(".fc-event-inner .fc-event-time",k).attr("title",l.Remarks);if(l.appointmentHtml){$(".fc-event-inner",k).append(l.appointmentHtml)}if(l.id){var i=$.fullCalendar.parseDate(l.InitialDateIso);var j=new Date();if((l.OffSet.TotalMinutes+j.getTimezoneOffset())!=0){$(".fc-event-title",k).prepend("(Local:-"+$.fullCalendar.formatDate(i,"h:mm TT")+")");$(".fc-event-title",k).attr("title",l.AppointmentOffsetDisplay)}}},viewDisplay:function(i){if(g=="True"){$("td > div:not(:has(span.app-addevent))",this).prepend('<span title="Create a new event" class="app-addevent ui-icon ui-icon-plus"></span>')}$("div.fc-view-basicDay thead th:not(:has(span.app-refresh))",this).prepend('<span title="Refresh" class="ui-icon ui-icon-refresh app-refresh"></span>');$("td div.fc-day-number, div.fc-view-basicWeek thead th",this).attr("title","Click to see the day view");if(c&&c!=i.name){$(this).fullCalendar("refetchEvents")}c=i.name},year:f?f.getFullYear():undefined,month:f?f.getMonth():undefined,date:f?f.getDate():undefined})}).on("click","span.ui-icon-close",function(d,c){$(d.target).parent("span.arrival-editor").find("input:text").timespinner("destroy").end().hide().nextAll("a.arrival-editor-button").show()}).on("click","span.ui-icon-check",function(g,d){var f=new Object();var c=$(g.target).parent("span.arrival-editor").find("input:text").each(function(e){f[$(this).attr("name")]=$(this).timespinner("value")}).end();f[$(g.delegateTarget).attr("data-id-param")]=d.id;f[$(g.delegateTarget).attr("data-appointmentTime-param")]=Number(d.start)/1000;$.ajax({url:$(g.delegateTarget).attr("data-updatearrival-url"),data:f,cache:false,type:"POST",context:g.delegateTarget}).done(function(e,i,h){$(this).fullCalendar("refetchEvents")}).error(function(h,i,e){alert(h.responseText)}).always(function(){$("span.ui-icon-close",c).click()})}).on("click","span.app-refresh",function(d,c){$("#calendar").fullCalendar("refetchEvents")}).on("click","a.arrival-editor-button",function(d,c){$(d.target).prevAll("span.arrival-editor").show().find("input:text").timespinner();$(d.target).hide();return false}).on("click","a.app-edit",function(d,c){$("#dlgAppointment").dialog("option",{title:"Edit Appointment",currentEvent:c}).dialog("open")}).on("click","a.app-delete",function(d,c){var f=confirm("Are you sure, you want to delete Appointment "+c.title+" ?");if(f){$.ajax({url:$(d.delegateTarget).attr("data-delete-url").replace(-1,c.id),type:"POST",data:c.id,success:function(e,h,g){$("#divAppntDltdError").html(e).addClass("ui-state-highlight");$("#calendar").fullCalendar("refetchEvents")},error:function(g,h,e){alert(g.responseText)}})}}).on("click","div.fc-view-basicWeek thead",function(f){var d=$("th",f.currentTarget).index($(f.target));var g=$(f.delegateTarget).fullCalendar("getView");var c=new Date(g.start);c.setDate(g.start.getDate()+d);$(f.delegateTarget).fullCalendar("gotoDate",c).fullCalendar("changeView","basicDay")});$("#calendarLoading").position({of:$(window)});$("#tbCarrier,#tbCarrierFilter").autocomplete({minLength:0,source:function(c,d){$.ajax({url:this.element.attr("data-list-url"),dataType:"json",context:this.element,beforeSend:function(e,f){this.addClass("ui-autocomplete-loading")},data:{term:c.term},success:function(e,g,f){d(e)},error:function(f,g,e){alert(f.responseText)},complete:function(e,f){this.removeClass("ui-autocomplete-loading")}})},change:function(c,d){$(this).change()},select:function(c,d){$("#divFilter").change()},autoFocus:true}).dblclick(function(c){$(this).autocomplete("search")});var a;$("#divBuildings, #divFilter, #divShipped").on("change",function(c){if(a==null){a=setTimeout(function(){$("#calendar").fullCalendar("refetchEvents");a=null},1000)}});$("#tbGotoAppointmentDate").datepicker({showOn:"button",buttonImage:$("#tbGotoAppointmentDate").attr("data-image-url"),buttonImageOnly:true,dateFormat:"m/d/yy",onSelect:function(){$(this).change()}}).change(function(d){if($(this).val()){var c=new Date($(this).val());$("#calendar").fullCalendar("gotoDate",c).fullCalendar("changeView","basicDay")}});$("#btnAppNumber").click(function(c){var d=$("#tbAppointmentNumber").val();if(isNaN(d)){alert("Appointment number must be a number.");$("#tbAppointmentNumber").val("");return}if(!d){$("#tbAppointmentNumber").val("");return}$("#tbAppointmentNumber").val("");$.ajax({url:$(this).attr("data-url").replace("-1",d)}).done(function(e,h,f){if(f.status==203){alert("Appointment Number "+d+" not found");return}var g=$.fullCalendar.parseISO8601(e.start,false);$("#calendar").fullCalendar("gotoDate",g).fullCalendar("changeView","basicDay");b.done(function(){var i=$("#calendar").fullCalendar("clientEvents",e.id);if(i.length>0){i[0].className="ui-selected";$("#calendar").fullCalendar("rerenderEvents")}else{alert("Appointment Number "+d+" not found")}})}).error(function(f,g,e){alert(f.responseText)})}).button()});